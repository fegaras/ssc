#/bin/bash

SSC_HOME="$(cd `dirname $0`/..; pwd -P)"

if [ ! -f "$SSC_HOME/lib/libgc.a" ]; then
   echo "Need to install libgc.a from https://github.com/ivmai/bdwgc/"
fi

for f in "$@"; do
  bn=`basename $f .ssc`
  echo "scala -cp $SSC_HOME/lib/SSC.jar edu.uta.ssc.SSC $f"
  scala -cp $SSC_HOME/lib/SSC.jar edu.uta.ssc.SSC $f
  echo "llc $bn.ll"
  llc $bn.ll
  echo "gcc-5 $bn.s -L$SSC_HOME/lib -lgc"
  gcc-5 $bn.s -L$SSC_HOME/lib -lgc
done
